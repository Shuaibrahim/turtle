<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Details</title>
  <script src="//unpkg.com/alpinejs" defer></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <a href="index.html">
          <img src="Pictures/Logo1.png" alt="Logo" class="logo img">
        </a>
        <h1 class="headerh1">Buy Tickets</h1>
      </header>

  <div x-data="payment" class="pay-container">

    <form x-on:submit.prevent="gotoConfirm">
      <table class="payment-table">
        <tr>
            <td class="p"><label for="cardNumber">Card Number</label></td>
            <td class="p"><input type="text" name="cardNumber" id="cardNumber" placeholder="Enter card number" required x-model="card.cardNumber"></td>
        </tr>
        <tr>
          <td class="p"><label for="expiryDate">ExpiryDate</label></td>
          <td class="p"><input type="text" name="expiryDate" id="expiryDate" placeholder="MM/YY" required x-model="card.expiryDate"></td>
        </tr>
        <tr>
            <td class="p"><label for="cvc">CVC / CVV</label></td>
            <td class="p"><input type="text" name="cvc" id="cvc" placeholder="Enter CVC / CVV" required x-model="card.cvc"></td>
        </tr>
        <tr>
          <td class="p"><label for="nameOnCard">Name on card</label></td>
          <td class="p"><input type="text" name="nameOnCard" id="nameOnCard" x-model="card.nameOnCard" required placeholder="Enter name on card"></td>
          </tr>
        </table>
        <div>
            <button type="submit" x-on:click="gotoConfirm" >Pay</button>
        </div>
    </form>


    <!-- Summary Table -->
    <div class="right-section">
      <table class="summary-table">
        <tr> <td>Date</td> <td x-text="savedDate"></td> </tr>
        <tr> <td>Time</td>
          <td>
            <template x-for="timeIndex in selectedTimeSlots">
              <div x-text="openTimes[timeIndex].title"></div>
            </template> 
          </td>
        </tr>
        <tr> <td>Duration</td><td x-text="selectedTimeSlots.length +' Hrs'"></td>
        <tr class="highlight-row"> <th>Tickets</th> <th>Charges</th> </tr>
        <template x-for="guestIndex in ticketTypes">
          <tr x-show="guestIndex.count > 0">
            <td x-text="guestIndex.count + ' ' + guestIndex.name"></td>
            <td x-text="guestIndex.total"></td>
          </tr>
      </template>
        <tr class="highlight-row"> <th>Total Payable</th> <td x-text="'$' +savedGrandTotal "></td> </tr>
      </table>
    </div>
  </div>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('payment', () => ({
          savedDate: null,
          ticketTypes:[],
          openTimes:[],
          selectedTimeSlots:[],
          savedGrandTotal:'',  
          card: {
                cardNumber: '',
                expiryDate: '',
                cvc: '',
                nameOnCard: ''
            },
            init() {
                this.savedDate = JSON.parse(localStorage.getItem('savedDate'));
                this.ticketTypes = JSON.parse(localStorage.getItem('ticketTypes'));
                this.openTimes = JSON.parse(localStorage.getItem('openTimes'));
                this.selectedTimeSlots = JSON.parse(localStorage.getItem('selectedTimeSlots'));
                this.savedGrandTotal = JSON.parse(localStorage.getItem('savedGrandTotal'));
            },
            gotoConfirm() {
                // set the card data to local storage
                localStorage.setItem('card', JSON.stringify(this.card))

                // redirect to payment page
                window.location.href = 'confirmation.html'
            }
        }))
    })
</script>

  
</body>
</html>